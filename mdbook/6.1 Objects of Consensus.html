<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Object of Consensus - IOTA 2.0 Research Specifications</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
                <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="0.0 Preface.html">Preface</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Control Files</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="1.1 Introduction.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.2.</strong> Table of Contents</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.3.</strong> Terminology</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.4.</strong> Index of parameters</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.5.</strong> References</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Structure</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">2.1.</strong> Data Types</div></li><li class="chapter-item expanded "><a href="2.2 Message Layout.html"><strong aria-hidden="true">2.2.</strong> Message Layout</a></li><li class="chapter-item expanded "><a href="2.3 Standard Payloads Layout.html"><strong aria-hidden="true">2.3.</strong> Payloads Layout</a></li><li class="chapter-item expanded "><a href="2.4 Data flow.html"><strong aria-hidden="true">2.4.</strong> Data Flow</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Network Layer</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Communication Models</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> Bootstrapping</div></li><li class="chapter-item expanded "><a href="3.3 Peer Discovery.html"><strong aria-hidden="true">3.3.</strong> Peer Discovery</a></li><li class="chapter-item expanded "><a href="3.4 Neighbor Selection.html"><strong aria-hidden="true">3.4.</strong> Neighbor Selection</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.5.</strong> Manual Peering</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Communication Layer</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="4.1 The Tangle.html"><strong aria-hidden="true">4.1.</strong> The Tangle</a></li><li class="chapter-item expanded "><a href="4.2 Timestamps.html"><strong aria-hidden="true">4.2.</strong> Timestamps</a></li><li class="chapter-item expanded "><a href="4.3 Tip Selection Algorithm.html"><strong aria-hidden="true">4.3.</strong> Tip Selection Algorithm</a></li><li class="chapter-item expanded "><a href="4.4 Solidification.html"><strong aria-hidden="true">4.4.</strong> Solidification</a></li><li class="chapter-item expanded "><a href="4.5 Rate Control.html"><strong aria-hidden="true">4.5.</strong> Rate Control</a></li><li class="chapter-item expanded "><a href="4.6 Congestion Control.html"><strong aria-hidden="true">4.6.</strong> Congestion Control</a></li><li class="chapter-item expanded "><a href="4.7 Markers.html"><strong aria-hidden="true">4.7.</strong> Markers</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.8.</strong> Message Creation</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Value Transfer Application</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="5.1 UTXO.html"><strong aria-hidden="true">5.1.</strong> UTXO</a></li><li class="chapter-item expanded "><a href="5.2 Ledger State.html"><strong aria-hidden="true">5.2.</strong> Ledger State</a></li><li class="chapter-item expanded "><a href="5.3 Mana.html"><strong aria-hidden="true">5.3.</strong> Mana</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Consensus Applications</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="6.1 Objects of Consensus.html" class="active"><strong aria-hidden="true">6.1.</strong> Object of Consensus</a></li><li class="chapter-item expanded "><a href="6.2 Opinion Setting.html"><strong aria-hidden="true">6.2.</strong> Opinion Setting</a></li><li class="chapter-item expanded "><a href="6.3 Fast Probabilistic Consensus.html"><strong aria-hidden="true">6.3.</strong> FPC</a></li><li class="chapter-item expanded "><a href="6.4 Finalization.html"><strong aria-hidden="true">6.4.</strong> Finalization</a></li><li class="chapter-item expanded "><a href="6.5 dRNG.html"><strong aria-hidden="true">6.5.</strong> dRNG</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><div>Appendix</div></li><li class="chapter-item expanded affix "><div>Snapshots</div></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">IOTA 2.0 Research Specifications</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="61-objects-of-consensus"><a class="header" href="#61-objects-of-consensus">6.1 Objects of Consensus</a></h1>
<h2 id="611-preliminaries"><a class="header" href="#611-preliminaries">6.1.1 Preliminaries</a></h2>
<h3 id="6111-motivation"><a class="header" href="#6111-motivation">6.1.1.1 Motivation</a></h3>
<p>FPC is a binary voting protocol where each node starts with an initial opinion (a nulled boolean) on an object.  Nodes then exchange queries and responses about their opinions during several rounds, until each node terminates with a final boolean value.</p>
<p>FPC votes on two specific objects types: messages, in order to enforce timestamps, and transactions, in order to decide double spends. Additionally, applications can use FPC to query opinions about their opinion on other object types, although there is no guarantee that they will get a response.</p>
<p>The FPC is agnostic about the rest of the protocol, particularly the questions being decided voting and how the initial opinions are set.  We require a generic way for FPC to interact with data structures in other applications. Specifically, an application needs a way to trigger FPC run. </p>
<p>Deciding when FPC should run is a delicate question for two reasons.</p>
<ol>
<li>It is inefficient for FPC to vote on every single transaction.</li>
<li>If only a sub set of nodes participate in FPC, they are more vulnerable to attack since the consensus mana held by this collection of nodes is potentially much smaller.
Thus, since it cannot vote on everything, it must use subjective criterion to trigger voting which does not leave any group vulnerable to attack.</li>
</ol>
<p>Voting is a two-part process: querying and answering queries.  The function <code>QueryStatus</code> determines if a node should query about a particular object, and the function <code>AnswerStatus</code> determines if the node should respond.</p>
<h3 id="6112-summary"><a class="header" href="#6112-summary">6.1.1.2 Summary</a></h3>
<p>This specification describes how this binary voting protocol interacts with the rest of the IOTA protocol.  Specifically, we define two functions, <code>QueryStatus</code> and <code>AnswerStatus</code> which govern when an object should be included in a query or response respectively. These functions depend on the metatdata <code>opinionField</code> which is also defined in this specification.</p>
<p>This specification only includes the format on how applications requiring FPC should interact with it, not how to set initial opinions or, more specifically, <code>opinionField</code>.  For this information.</p>
<h3 id="6113-parameters-and-lists"><a class="header" href="#6113-parameters-and-lists">6.1.1.3 Parameters and lists</a></h3>
<table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>DSMALL</code></td><td>duration</td><td>small estimated network delay, set to 5 seconds</td></tr>
<tr><td><code>votingEnabledObjectTypes</code></td><td>list</td><td>object types which will be voted upon</td></tr>
</tbody></table>
<h2 id="612-detailed-design"><a class="header" href="#612-detailed-design">6.1.2 Detailed design</a></h2>
<h2 id="6121-voting-objects-list"><a class="header" href="#6121-voting-objects-list">6.1.2.1 Voting Objects list</a></h2>
<p>FPC can potentially vote on a variety of matters.  The <code>votingEnabledObjectTypes</code> effectively lists which things will be voted upon by listing the object types which must be queried by FPC.  Specifically, when FPC prepares a query, it iterates through each object type, and then finds which objects of that type it must include in the query.</p>
<p>By default, the object types <code>message</code> and <code>transaction</code> are in the list <code>votingEnabledObjectTypes</code>.  However, a second layer application can add other object types to this list, allowing other applications to use FPC. These applications will have no guarantee that they will receive responses with about custom object types, particularly if the application is not widely used.</p>
<h3 id="6122-how-opinions-on-objects-are-stored"><a class="header" href="#6122-how-opinions-on-objects-are-stored">6.1.2.2 How opinions on objects are stored</a></h3>
<p>For every object whose type is in <code>votingEnabledObjectTypes</code>, that the local meta data stored with the object must include an <code>opinionField</code> which is either <code>NULL</code>  or the triplet <code>(opinion,level,timeFormed)</code>.  The field <code>opinion</code> is a nullable boolean value,  <code>level</code> is a number in the list \({1,2,3}\), and <code>timeFormed</code> is the time the field was changed from <code>NULL</code>.</p>
<p>As will be discussed in a different specification, an opinion field will be  <code>NULL</code> until the node has received information allowing it to form an opinion, e.g. detect a conflict.  For example,  a transaction should have opinion field  <code>NULL</code> until a conflict is detected.  Such transactions should be considered &quot;good&quot;, and, in the honest setting, most transactions will have a <code>NULL</code> opinion. </p>
<h3 id="6123-query-status"><a class="header" href="#6123-query-status">6.1.2.3 Query Status</a></h3>
<p>When FPC prepares a query, see the <a href="link">FPC</a> specification, it <em>shall</em> determine which objects to include.  Conceptually, for each type in <code>votingEnabledObjectTypes</code>, the node <em>shall</em> iterate through all objects of that type and individually decide if that object is to be included in the query. Clearly, this iteration would be inefficient expensive, and a node can use some method to speed up the process.  However, this is an implementation detail and thus beyond the scope of this document.</p>
<p>To determine whether or not each object should be included into a query, a node shall apply the following <code>QueryStatus</code> function.  If the function returns true, then the object should be included into the query.</p>
<pre><code class="language-vbnet">FUNCTION Bool = QueryStatus(type,objectID)
IF type not in VotingEnabledObjectTypes
    RETURN FALSE
ELSE IF opinionField != NULL AND level =1 and currentTime &gt; timeFormed+DSMALL
    RETURN TRUE
ELSE RETURN FALSE      
IF the object does not exist
    RETURN `FALSE`.
</code></pre>
<p>When FPC succesfully stops voting on an object, it sets in the <code>opinionField</code> the <code>opinion</code> to the final opinion and modifies <code>level</code>  to <code>2</code> so that <code>QueryStatus</code> returns false.</p>
<h3 id="6124-answer-status"><a class="header" href="#6124-answer-status">6.1.2.4 Answer Status</a></h3>
<p>Every time FPC receives a query request, it checks whether or not it should reply; see <a href="Link">FPC</a>.  To do so, it applies the following  <code>AnswerStatus</code> function to object in the query request to determine if a response should be made.  If <code>AnswerStatus</code> returns <code>FALSE</code> for any object in the query request, a query response will not be prepared.</p>
<pre><code class="language-vbnet">FUNCTION Bool=AnswerStatus(type,objectID)
If type not in VotingEnabledObjectTypes
    RETURN FALSE
ELSE IF opinionField not = NULL AND (level = 1 OR level = 2) 
    RETURN TRUE
ELSE RETURN FALSE 
</code></pre>
<p>Lastly, if the object does not exist, the function should return <code>FALSE</code>.</p>
<h1 id="613-rationale-and-alternatives"><a class="header" href="#613-rationale-and-alternatives">6.1.3 Rationale and Alternatives</a></h1>
<p>The <code>level</code> field indicates the level of knowledge. It tells us information about what other nodes know.</p>
<ul>
<li>Level 1 means that the node only knows that it holds this opinion.</li>
<li>Level 2 means that the node knows that all nodes have this opinion too (with high probability).</li>
<li>Level 3 means that the node knows that all nodes have level 2 knowledge (with high probability).</li>
</ul>
<p>If a node node only has level 1 knowledge, it needs to vote.  However, if it has level 2 knowledge, it does not need to query as it knows that all nodes have the same opinion. With level 3 knowledge, it knows that no other nodes have level 2 knowledge and thus should not send its node queries.  Thus, with level 3 knowledge, the node does not need to respond. The level of knowledge is the primary criterion in these functions.</p>
<p>Moreover, we should not query about objects whose opinion is <code>NULL</code>. In a similar vein, we need should not query about an object until <code>d</code> time after the opinion was set, so we can be sure that all other nodes have set their opinion too. </p>
<p>Alternatively, we can attempt to manage the same system with a series of finality flags.  However, this has two problems.  First,  we either mark objects which we have never voted upon as final, or some objects will never get a finality flag.  This leads to some complicated, unintuitive logic. 
Second, if an attacker can cause only small portions of the network to vote on an object, that vote would be susceptible to an attack.  Thus we need consensus about what to vote on. However, if voting is a binary &quot;yes&quot; or &quot;no&quot;, we would need a consensus algorithm to determine when to vote.  The levels of knowledge does not treat voting in a binary way, bypassing this problem.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="5.3 Mana.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="6.2 Opinion Setting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="5.3 Mana.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="6.2 Opinion Setting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
