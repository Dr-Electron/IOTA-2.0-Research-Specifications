# 4.4 Solidification
This section defines how messages get solid in the Tangle.

## 4.4.1 Motivation
**Solidification** is a process of requesting missing referenced messages. It may be recursively repeated until all of a message's past cone up to the genesis (or snapshot) becomes solid.

In that way, the Tangle enables all nodes to retrieve all of a message's history, even the ones joining the network at a point later in time.

## 4.4.2 Definitions
* **valid**: A message is considered valid if it follows the protocol, i.e., if it passes the following checks from the solidifier and from the message booker:
    * solidifier: it checks if parents are valid,
    * booker: it check if the contained transaction is valid. Notice that only messages containing a transaction are required to perform this check.
* **parents age check**: A check that ensures the timestamps of parents and child are valid, following the details defined in Timestamp specification [Parent age check](#parent-age-check) 
> TODO: put the link of timestamp check
* **solid**: A message is solid if it passes parents age check and all its parents are stored, solid and valid.

## 4.4.3 Detailed Design
During solidification, if a node is missing a referenced message, the corresponding ID is stored in the `solidification buffer`. A node asks its neighbors for the missing message by sending a `solidification request` containing the message ID. Once the requested message is received from its neighbors, it shall be removed from the `solidification buffer` once a node receives it from its neighbors. The requested message is marked as solid after it passes the following checks:
1. all its parents are in the storage of this node and also marked as solid,
2. it passes the parent age check,
3. all its parents are valid.

Figure 4.4.3.1 shows solidification process:

![GoShimmer-flow-solidification_spec](https://user-images.githubusercontent.com/11289354/114823182-be49fb80-9df5-11eb-9df1-51098f1e4468.png)
<p style="text-align: center;">
    Figure 4.4.3.1, solidification workflow
</p>

## 4.4.4 Packet
Nodes send and receive solidification request/response from port 14666. If a node does not get the requested message within `maxRequestThreshold` rounds, the `solidification request` must be removed from the `solidification buffer`.

Below we define the packets of solidification request and response: 

### Solidification request
<table>
     <tr>
         <th>Name</th>
         <th>Type</th>
         <th>Description</th>
     </tr>
     <tr>
         <td>type</td>
         <td>uint8</td>
         <td>Defines the type of the packet.</td>
     </tr>
     <tr>
         <td>Id</td>
         <td>ByteArray</td>
         <td>contains the message ID of requested message.</td>
     </tr>
 </table>

### Solidification response
<table>
     <tr>
         <th>Name</th>
         <th>Type</th>
         <th>Description</th>
     </tr>
     <tr>
         <td>type</td>
         <td>uint8</td>
         <td>Defines the type of the packet.</td>
     </tr>
     <tr>
         <td>Id</td>
         <td>ByteArray</td>
         <td>contains the entire requested message.</td>
     </tr>
 </table>